---
title: B树、B+树
date: 2022-09-28 23:35
tags: 
- tech
- data_structure
- BTree&B+Tree
---

# B树和B+树

## B树的特点（也称B-树）

**B树**：又称多路平衡查找树（与平衡二叉树区分开），B树中所有节点的孩子个数的最大值称为**B树的阶**，通常用 m 表示，一棵 m阶B树或为空树，或为满足一下特性的 m叉树：

+ 树中每个结点至多有 **m棵子树**，即至多含有 **m - 1个关键字**。（关键字即查找的元素值）；

+ 若根结点不是终端结点，则至少有两棵子树；

+ 策略：m叉查找树中，规定对于**任何一个结点**，其**所有子树的高度都要相等**，以用来**保证B树的查找效率**；

  **除根节点外**的所有非叶结点**至少有⌈m/2⌉ 棵子树**，即至少含有**⌈m/2⌉ - 1 个关键字**；

+ 所有非叶结点的结构如下：

  ![image-20221008212646349](./img/image-20221008212646349.png)

  ​	其中，Ki（i= 1,2,3...,n）为结点的关键字，且满足**K1 < K2 < ... < Kn（关键字大小从左到右依次递增）**；Pi（i= 1,2,3...,n）为指向

  子树根结点的指针，且指针**Pi-1所指子树中所有结点的关键字均小于Ki**，**Pi所指子树中所有结点的关键字均大于Ki**，n（⌈m/2⌉ - 1 ≤ n ≤ m - 1）为结点中关键字的个数。

+ 所有的叶结点都出现在同一层次上，并且不带信息（可以视为外部结点或类似于折半查找判定树的查找失败结点，实际上这些结点不存在，指向这些结点的指针为空）。

**图示：**

![image-20220929000502291](./img/image-20220929000502291.png)

<!-- more -->

**平衡二叉树的左右子树高度只能是-1，0，1，但是B树的左右子树高度差只能为0（即左右子树高度都要相等）**，也可以结合二叉排序树来记忆，即**左子树**的元素值 \< **根节点**的元素值 \< **右子树**的元素值。

**注：**

​	+  **根结点的子树数∈[2，m]，关键字数∈[1，m - 1]**

​	+  **其他结点的子树数∈[⌈m/2⌉，m]，关键字数∈[⌈m/2⌉ - 1，m - 1]**

### B树的插入和删除（插入只能在最底层的终端结点中）

**① 对 m阶B树---除根节点外，结点关键字个数 ⌈m/2⌉ - 1 ≤ n ≤ m - 1**

**② 要永远保证 子树0 < 关键字1 < 子树1 < 关键字2 < 子树2 < ...**

**参考：**https://www.bilibili.com/video/BV1b7411N798?p=73&spm_id_from=pageDriver&vd_source=e8dabb7e7d08d095b938c58a3b51a693

#### 插入：

​	**要考虑当插入关键字之后结点超过 m - 1时，需要将当前结点进行拆分，拆分出不同的两棵子树，且关键字大小在中间的关键字提到父节点中，作为拆分出来的新节点分别在这个被提结点的左右**

#### 删除：

​	**删除则需要保证删除关键字之后结点中的关键字个数小于 ⌈m/2⌉ - 1时，需要往兄弟借或者合并结点**

**删除非终端结点：**

![image-20221008220205166](./img/image-20221008220205166.png)

**删除终端结点**：

![image-20221008220325017](./img/image-20221008220325017.png)

![image-20221008220917232](./img/image-20221008220917232.png)

## B+树的特点（类比OS中的文件管理中的索引存储）

B+树和B树是两个概念，一个是用来存储，B+树更多是用来存储磁盘的文件类资源

**图示：**

![image-20221008223350200](./img/image-20221008223350200.png)

**一棵m阶的B+树需满足下列条件：**

+ 每个分支结点最多有m棵子树（孩子结点）；
+ **非叶根结点至少有两棵子树**，其他每个分支结点**至少有 ⌈m/2⌉ 棵子树**；
+ **结点的子树个数与关键字个数相等**；
+ 所有**叶结点包含全部关键字**及指向相应记录的指针，叶结点中将关键字按大小顺序排列，并且**相邻叶结点按大小顺序相互链接起来**。

**注：**

在B+树中，**非叶结点不含有该关键字对应记录的存储地址**；

可以使一个磁盘块可以包含更多个关键字，使得B+树的阶更大，**树高更矮，读磁盘次数更少**，查找更快。

---

## B树、B+树的联系和区别

![image-20221008234738642](./img/image-20221008234738642.png)

### m阶B树（m阶B-树）：

+ 结点中的n个关键字对应 n + 1棵子树；

+ 根结点的关键字数 n∈[1，m - 1]

  其他结点的关键字数 n∈[⌈m/2⌉ - 1，m - 1]；

+ 在B树中，各结点中包含的关键字是不重复的；

+ B树的结点中都包含了关键字对应的记录的存储地址。

**注：**不会出现两个相同的关键字，且关键字即是记录，区别B+树（B+树中关键字为记录的指针），不支持顺序查找。

### m阶B+树：

+ 结点中的n个关键字对应n棵子树；

+ 根结点的关键字数 n∈[1，m]

  其他结点的关键字数 n∈[⌈m/2⌉，m]；

+ 在B+树中，叶结点包含全部关键字，非叶结点中出现过的关键字也会出现在叶结点中；

+ 在B+树中，叶结点包含信息，所有非叶结点仅起索引作用，非叶结点中的每个索引项只含有对应子树的最大关键字和指向该子树的指针，不含有该关键字对应记录的存储地址。

**注：**B+树支持顺序查找，由于所有的叶子结点都是由一个链表链接在一起的，所以可以直接通过链头指针遍历到所有的关键字。

+++

## 参考：https://www.bilibili.com/video/BV1b7411N798
