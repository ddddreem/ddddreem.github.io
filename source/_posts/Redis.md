---
title: Redis学习笔记
data: 2022-07-05 16:22
tags: 
- tech
- nosql
- redis主从复制
---
# redis主从复制

最近浅学了一下redis，下面就是我觉得重要的一个点。

## 介绍：

+ 主机数据更新后根据配置和策略， 自动同步到备机的master/slaver机制，==Maste==r以==写==为主，==Slave==以==读==为主

+ 可以这样帮助理解：主机相当于房东，从机相当于房客，房客不能损坏出租房里的东西，但是有使用的权限；而出租房是属于房东的，房东有权利去收走或者添置出租屋里的东西。
+ 上面那个例子可能也不太好理解，反正就是主机可以有读写的权限，从机只有读的权限。

## 作用：

+ 使读操作和写操作分离来，提高性能

+ 容灾快速恢复：我认为的是系统突然遇到一些突发情况不能继续工作，容灾快速恢复可能是发生这种情况之后可以根据备份文件或者其他技术来恢复数据（==个人理解==）

  ![image-20220629152629791](./img/image-20220629152629791.png)

## 实现：

首先创建一个目录用来保存开启主从复制的redis服务的配置文件

![image-20220629161152032](./img/image-20220629161152032.png)

在redis的解压文件中拷贝一份redis的配置文件到新建的目录下

拷贝的这一份配置文件需要设置：

1. 设置为守护进程：即可以让redis在后台启动
2. 如果需要其他主机访问本机的redis服务：需要将配置文件中的protected-mode设置为no，并且将bind 127.0.0.1注释掉
3. 如果需要AOF持久化，需要设置配置文件中的appendonly为yes，如果只是为了演示一下，可以关闭AOF持久化

拷贝redis的配置文件到新建目录下，编辑拷贝过来的配置文件，我这里是关了AOF持久化的配置

具体的redis配置文件的配置如下，

+ include [filename] 引入配置文件
+ pidfile [pidfile] 进程标识号的文件
+ port [xxxx] 服务的端口号
+ dbfilename [dbfilename] RDB持久化备份文件名

![image-20220629174336363](./img/image-20220629174336363.png)

![image-20220629174043078](./img/image-20220629174043078.png)

分别启动三个redis服务

![image-20220629172152447](./img/image-20220629172152447.png)

分别进入到服务器的客户端`redis-cli -p xxxx`：进入到指定端口的redis客户端

进入客户端之后输入info replication 可以查看redis服务器的信息，如下图。

![image-20220629180033076](./img/image-20220629180033076.png)

`slaveof 主机地址 端口号` ： 将本服务器作为目的服务器的从服务器

![image-20220629175933385](./img/image-20220629175933385.png)

主服务器的info replication显示如下：

![image-20220629175558947](./img/image-20220629175558947.png)

## ==注意：==

当设置了的主从复制类似于薪火相传模式：即一台主机一个从机，从机还有一台从机。

​	这种情况下注意，当中间的从机宕机后，属于这台从机的从机会等待这台宕机的机器重启，且不会变成master，

依旧是以slave的角色挂接在这台宕机的机器上；但是如果宕机的这台机器重新上线，他不再是之前master的从机了，

而是自己变成主机。

![image-20220705160403316](./img/image-20220705160403316.png)

中间的从机宕机重连之后：不再是之前主机的从机，而是自己变成主机。

![image-20220705161819996](./img/image-20220705161819996.png)

## 参考地址：